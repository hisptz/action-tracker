<div *ngIf="dataLoaded$ | async">
  <table
    class="table table-bordered table-responsive"
    #rootCauseAnalysisTable
    *ngIf="configuration$ | async as rootCauseAnalysisConfiguration"
  >
    <thead class="table-header-cell thead-light">
      <tr>
        <th width="1%">SN.</th>
        <th
          [hidden]="dataElement.isHidden"
          *ngFor="
            let dataElement of rootCauseAnalysisConfiguration.dataElements
          "
        >
          {{ dataElement.name }}
        </th>
        <th width="2%">Actions</th>
      </tr>
    </thead>
    <tbody *ngIf="data$ | async as rootCauseAnalysisData" [@listEnter]>
      <tr
        *ngFor="
          let dataItem of rootCauseAnalysisData;
          let i = index;
          trackBy: dataItem?.id
        "
        class="{{ dataItem?.rootCauseDataId }}"
        id="{{ dataItem?.id || dataItem?.rootCauseDataId }}"
        [contextMenu]="extraActions"
        [contextMenuSubject]="dataItem"
      >
        <td>{{ i + 1 }}</td>
        <td
          [hidden]="dataElement.isHidden || toBeDeleted[dataItem.id]"
          *ngFor="
            let dataElement of rootCauseAnalysisConfiguration.dataElements;
            let j = index
          "
          [ngClass]="{
            'action-tracker-column': dataElement.isActionTrackerColumn,
            'solution-column': !dataElement.isActionTrackerColumn
          }"
        >
          <ng-container id="dataItem?.id_dataElement?.id">
            <div
              *ngIf="
                (!dataItem.isActive && !dataItem.isHidden) ||
                (dataItem.isActive &&
                  !dataElement.optionSetValue &&
                  dataElement.valueType == 'AUTO_FILLED')
              "
              class="form-control auto-filled-label table-cell-data"
            >
              {{ dataItem.dataValues[dataElement.id] }}
            </div>
          </ng-container>
          <a
            title="Save when done"
            class="text-secondary custom-done-icon"
            (click)="onDoneEditing($event, dataItem)"
            *ngIf="
              j == rootCauseAnalysisConfiguration.dataElements.length - 1 &&
              dataItem.isActive
            "
          >
            <i class="icon-ok-circled2"></i
          ></a>
        </td>
        {{
          dataElement
        }}
        <td
          class="action-tracker-column"
          [hidden]="!dataItem.rowspan"
          [attr.rowspan]="dataItem.rowspan"
        >
          <div class="action-tracker-form-wrapper" hidden="true">
            <action-tracker-form
              [dataItem]="dataItem"
              [configurations]="actionTrackerConfiguration$ | async"
              (save)="onSave($event, dataItem)"
              (cancel)="cancelDataEntryForm($event, rootCauseAnalysisData)"
            ></action-tracker-form>
          </div>
          <button
            class="btn btn-outline-secondary btn-add-action"
            (click)="
              onAddAction($event, dataItem, rootCauseAnalysisConfiguration)
            "
          >
            <i class="fa fa-plus"></i>
          </button>
        </td>
      </tr>
      <tr *ngIf="!rootCauseAnalysisData.length">
        <td colspan="100%" class="text-sm text-secondary">
          <p class="text-center mb-0">
            <i>
              No registered root causes for {{ selectedOrgUnit }} in
              {{ selectedPeriod }}
            </i>
          </p>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="(!configurationLoaded$ | async) && !(dataLoaded$ | async)">
    <div class="d-flex my-1">
      <div class="flex-fill mx-1" *ngFor="let count of [1, 2, 3, 4, 5, 6, 7]">
        <app-widget-item-loader [height]="'40px'"></app-widget-item-loader>
      </div>
    </div>
    <div class="d-flex my-1">
      <div class="flex-fill mx-1" *ngFor="let count of [1, 2, 3, 4, 5, 6, 7]">
        <app-widget-item-loader [height]="'40px'"></app-widget-item-loader>
      </div>
    </div>
    <div class="d-flex justify-content-between my-2 mx-1">
      <div style="width: 150px;">
        <app-widget-item-loader [height]="'40px'"></app-widget-item-loader>
      </div>
      <div style="width: 150px;">
        <app-widget-item-loader [height]="'40px'"></app-widget-item-loader>
      </div>
    </div>
  </div>
</div>

<context-menu
  [useBootstrap4]="true"
  *ngIf="configuration$ | async as rootCauseAnalysisConfiguration"
>
  <ng-template
    contextMenuItem
    class="text-muted px-2"
    (execute)="showMessage('Now Editing')"
  >
    Edit
  </ng-template>
  <hr />
  <ng-template
    contextMenuItem
    class="text-muted px-2"
    (execute)="
      onActionDelete($event.item, rootCauseAnalysisConfiguration?.dataElements)
    "
  >
    Delete
  </ng-template>
</context-menu>
