import * as _ from 'lodash';
import { generateUid } from './generate-uid.helper';
import { getFormattedDate } from './generate-formatted-date.helper';
import {
  programId,
  trackedEntityType,
  programStage
} from '../constants/program-items.constant';
export function generateTEI(actionTrackerDataItem, isActionTracking?) {
  return {
    rootCauseDataId: _.get(actionTrackerDataItem, 'rootCauseDataId'),
    trackedEntityInstance: actionTrackerDataItem.trackedEntityInstance, // if not there autogen
    trackedEntityType: trackedEntityType,
    orgUnit: _.get(actionTrackerDataItem, 'orgUnit'),
    attributes: _.get(actionTrackerDataItem, 'attributes'),
    enrollments: actionTrackerDataItem.enrollments || [
      {
        trackedEntityInstance: actionTrackerDataItem.trackedEntityInstance, // if not there autogen
        program: programId,
        status: 'ACTIVE',
        orgUnit: _.get(actionTrackerDataItem, 'orgUnit'),
        enrollmentDate: getFormattedDate(), //todays date
        incidentDate: getFormattedDate(), //todays date
        enrollment: generateUid(), // autogenerated
        events: isActionTracking
          ? [
              {
                event: generateUid(), // autogenerated
                dataValues: _.get(actionTrackerDataItem, 'dataValues'),
                program: programId, //const
                programStage: programStage, //const
                orgUnit: _.get(actionTrackerDataItem, 'orgUnit'),
                trackedEntityInstance:
                  actionTrackerDataItem.trackedEntityInstance,
                status: 'ACTIVE',
                eventDate: _.get(actionTrackerDataItem, 'eventDate')
              }
            ]
          : []
      }
    ]
  };
}
